<div>
    <section class="w-full h-auto mb-10 bg-white border shadow-xl sm:bg-white rounded-xl">
        <x-button_back class="bg-white">
            <x-slot name="route"> {{route('courses.groups')}} </x-slot>
            {{ __('courses.groups') }}
        </x-button_back>
        <div class="flex items-center my-5 text-center">
            <?xml version="1.0" ?>
            <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.0//EN' 'http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd'>
            <svg height="72px" style="enable-background:new 0 0 110 110;" version="1.0" viewBox="0 0 110 110"
                width="110px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink">
                <g id="Artboard" />
                <g id="Multicolor">
                    <g>
                        <circle cx="55" cy="55" r="55" style="fill:#FABC3D;" />
                    </g>
                    <g>
                        <g>
                            <polygon points="67,67.997 65,66.997 45,66.997 43,67.997 55,87    " style="fill:#E2E4E5;" />
                        </g>
                        <path
                            d="M70,45c-1,0-1,1.111-1,1.111V45c-0.002-1.065-0.019-2.086-0.067-3.062C64.891,38.001,55,38,55,38    s-9.891,0.001-13.933,3.938C41.019,42.914,41.002,43.935,41,45v7.997l4,10l5.105,3.996c0.569,0.639,1.384,1.004,2.24,1.004H55    h2.655c0.856,0,1.671-0.365,2.24-1.004L65,62.997l3.207-8.017C71.042,54.776,72,50.476,72,47.222C72,46.111,71,45,70,45z"
                            style="fill:#F8E1C2;" />
                        <path
                            d="M41,45v1.111c0,0,0-1.111-1-1.111s-2,1.111-2,2.222c0,3.253,0.958,7.554,3.793,7.758L45,62.997    l5.105,3.996c0.569,0.639,1.384,1.004,2.24,1.004H55V38c0,0-9.891,0.001-13.933,3.938C41.019,42.914,41.002,43.935,41,45z"
                            style="fill:#FCF1E2;" />
                        <g>
                            <path d="M50,56.997h10c0,0,0,3-5,3S50,56.997,50,56.997z" style="fill:#F79392;" />
                        </g>
                        <g>
                            <path
                                d="M61,47.322c1.191,0,2.248,0.266,2.981,0.678c0.071-0.569-0.172-1.154-0.748-1.59     c-1.03-0.781-2.702-0.781-3.733,0c-0.464,0.352-0.709,0.801-0.753,1.26C59.389,47.451,60.164,47.322,61,47.322z"
                                style="fill:#3E3E3F;" />
                        </g>
                        <g>
                            <path
                                d="M48.993,47.322c-1.191,0-2.248,0.266-2.981,0.678c-0.071-0.569,0.172-1.154,0.748-1.59     c1.03-0.781,2.702-0.781,3.733,0c0.464,0.352,0.709,0.801,0.753,1.26C50.604,47.451,49.829,47.322,48.993,47.322z"
                                style="fill:#3E3E3F;" />
                        </g>
                        <path
                            d="M57.655,67.997H55h-2.655c-0.856,0-1.671-0.365-2.24-1.004L45,62.997v4.5c0,0,0,7.5,10,7.5    s10-7.5,10-7.5v-4.5l-5.105,3.996C59.326,67.632,58.511,67.997,57.655,67.997z"
                            style="fill:#F4D0A1;" />
                        <g>
                            <path
                                d="M55,38c0,0-0.758,0-1.938,0.083c0,1.25,0,4.243,0,5.625c3.719,0,5.972-2.684,7.274-5.234     C57.41,38.001,55,38,55,38z"
                                style="fill:#3E3E3F;" />
                            <path
                                d="M45.919,39.332C44.022,39.922,42.228,40.772,41,42c0,3.542,2.323,5.25,2.323,5.25     C43.029,44.294,43.013,42.368,45.919,39.332z"
                                style="fill:#3E3E3F;" />
                            <path
                                d="M46.865,39.062c0,0.954,0,2.799,0,4.647c2.865,0,5.149-4.054,5.918-5.604     C51.218,38.226,49.027,38.49,46.865,39.062z"
                                style="fill:#3E3E3F;" />
                            <path
                                d="M66.344,40.205c0,0.387,0,4.515,0,7.045c2.488,0,2.646-4.661,2.655-5.25     C68.278,41.278,67.361,40.689,66.344,40.205z"
                                style="fill:#3E3E3F;" />
                            <path
                                d="M61.917,38.771c0,1.695,0,3.526,0,4.938c3.354,0,4.325-3.171,4.418-3.508     C64.968,39.551,63.421,39.093,61.917,38.771z"
                                style="fill:#3E3E3F;" />
                        </g>
                        <path
                            d="M50.105,66.993L45,62.997v4.5c0,0,0,7.5,10,7.5v-7h-2.655    C51.489,67.997,50.674,67.632,50.105,66.993z"
                            style="fill:#F8E1C2;" />
                        <g>
                            <path
                                d="M34.491,53.445v-19.62c-0.697-0.249-1.368-0.493-2-0.728v20.348c-2.61,1.72-1,6.85-1,9.555     c0.995,0,1.544,0,1.842,0c0.064,0,0.116,0,0.158,0c0.13,0,0.168,0,0.158,0c0.297,0,0.847,0,1.842,0     C35.491,60.295,37.102,55.165,34.491,53.445z"
                                style="fill:#FA5655;" />
                            <path
                                d="M82,31c0-1-25-8-27-8s-27,7-27,8c0,0.625,7.432,3.207,13,5.053c0,1.724,0,3.768,0,5.947     c4-4,14-4,14-4s10,0,14,4c0-2.18,0-4.223,0-5.947C74.568,34.207,82,31.625,82,31z"
                                style="fill:#3E3E3F;" />
                        </g>
                        <g>
                            <polygon points="66.965,68.059 67,68 65,67 55.015,71.981 60.808,77.807    "
                                style="fill:#FFFFFF;" />
                        </g>
                        <g>
                            <polygon
                                points="59,87 56.201,76.8 58,75.002 54.981,71.978 51.983,74.976 53.801,76.793 51,87    "
                                style="fill:#DF2C2C;" />
                        </g>
                        <g>
                            <polygon points="55,87 55,71.997 54.981,71.978 51.983,74.976 53.801,76.793 51,87    "
                                style="fill:#FA5655;" />
                        </g>
                        <g>
                            <polygon points="43.035,68.059 43,68 45,67 54.985,71.981 49.192,77.807    "
                                style="fill:#FFFFFF;" />
                        </g>
                        <g>
                            <path d="M23,87l4-11c0.615-1.333,1.698-2.394,3.043-2.983L43,68l12,19H23z"
                                style="fill:#3E3E3F;" />
                        </g>
                        <g>
                            <path d="M87,87l-4-11c-0.615-1.333-1.698-2.394-3.043-2.983L67,68L55,87H87z"
                                style="fill:#3E3E3F;" />
                        </g>
                        <g>
                            <polygon points="55,87 43,68 34,71 51,87    " style="fill:#9E9FA0;" />
                        </g>
                        <g>
                            <polygon points="55,87 67,68 76,71 59,87    " style="fill:#9E9FA0;" />
                        </g>
                    </g>
                </g>
            </svg>
            <h1 class="ml-2 text-2xl font-extrabold text-center text-indigo-600">Calificaciones</h1>
        </div>
        <p class="my-2 ml-5 text-lg font-bold text-indigo-600">{{$course->name}}</p>
        <p class="my-2 ml-5 text-base font-bold text-gray-600">Ciclo escolar: <span
                class="text-base font-normal">{{$course->schoolCycles->cycle_name}}</span></p>
        <p class="my-2 ml-5 text-base font-bold text-gray-600">Alumnos inscritos: <span
                class="text-base font-normal">{{$course->studentCourses->count()}}</span></p>
    </section>

    <section>
        <div wire:ignore.self
            class="w-full h-auto p-6 mb-10 space-y-6 bg-white border shadow-2xl sm:bg-white rounded-xl">
            @if ($students->count() >0)
            <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
                <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                    <thead class="text-xs text-white uppercase bg-blue-600 dark:bg-gray-700 dark:text-gray-400">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-center ">
                                Matrícula
                            </th>
                            <th scope="col" class="px-6 py-3 text-center ">
                                Nombre del alumno
                            </th>
                            <th scope="col" class="px-2 py-3 text-center">
                                P1
                            </th>
                            <th scope="col" class="px-2 py-3 text-center">
                                P2
                            </th>
                            <th scope="col" class="px-2 py-3 text-center">
                                P3
                            </th>
                            <th scope="col" class="px-2 py-3 text-center">
                                Calificación final
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <form wire:submit.prevent="saveQualifications">

                            @foreach($students as $student)
                            <tr
                                class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                                <th scope="row"
                                    class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                                    {{$student->studentID}}
                                <td class="w-1/3 px-6 py-4 text-center">
                                    {{$student->student_name.' '.$student->paternal_surname.'
                                    '.$student->maternal_surname}}
                                </td>
                                <td class="px-1 py-4 text-center">
                                    <input type="text" id="student_{{ $student->studentID }}"
                                        name="qualifications[{{ $student->studentID }}][p1]"
                                        wire:model.defer="qualifications.{{ $student->studentID }}.p1"
                                        class="w-full px-3 py-1 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        min="0" max="10" step="0.1">


                                </td>
                                <td class="px-1 py-4 text-center">
                                    <input type="text" id="student_{{ $student->studentID }}"
                                        name="qualifications[{{ $student->studentID }}][p2]"
                                        wire:model.defer="qualifications.{{ $student->studentID }}.p2"
                                        class="w-full px-3 py-1 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        min="0" max="10" step="0.1">
                                </td>
                                <td class="px-1 py-4 text-center">
                                    <input type="text" id="student_{{ $student->studentID }}"
                                        name="qualifications[{{ $student->studentID }}][p3]"
                                        wire:model.defer="qualifications.{{ $student->studentID }}.p3"
                                        class="w-full px-3 py-1 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        min="0" max="10" step="0.1">
                                </td>
                                <td class="px-1 py-4 text-center">
                                    <input type="text" id="student_{{ $student->studentID }}"
                                        name="qualifications[{{ $student->studentID }}][promedio_final]"
                                        wire:model.defer="qualifications.{{ $student->studentID }}.promedio_final"
                                        class="w-1/2 px-3 py-1 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        min="0" max="10" readonly>
                                </td>

                            </tr>
                            @endforeach
                            <div class="flex justify-center my-4">
                                <button type="submit"
                                    class="flex items-center p-2 px-4 py-1 text-xs font-semibold tracking-widest text-white uppercase transition duration-150 ease-in-out bg-green-500 border border-transparent rounded-md hover:bg-green-600">
                                    <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="32" height="32">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z">
                                        </path>
                                    </svg>
                                    <label class="ml-2">Guardar</label>
                                </button>
                            </div>
                        </form>
                    </tbody>
                </table>
            </div>
            @else
            <p class="text-base text-center text-gray-600">No hay alumnos registrados a este grupo</p>
            @endif
    </section>
</div>

@push('scripts')

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    Livewire.on('alertSuccess', function (data, title = 'Éxito') {
    Swal.fire({
        icon: 'success',
        title: title,
        text: data.message,
        confirmButtonText: 'Aceptar',
        timer: 5000
    });
});    
</script>

<script>
    // Función para validar la entrada en tiempo real
    function validateInput(event) {
      var keyCode = event.keyCode || event.which;
      var key = String.fromCharCode(keyCode);
      var value = event.target.value + key;
    
      var decimalSeparator = ".";
      var maxDecimals = 2;
    
      // Permitir las teclas de navegación y otras teclas especiales
      if (event.keyCode === 8 || event.keyCode === 9 || event.keyCode === 13 || event.keyCode === 27 || event.keyCode === 46 || event.keyCode === 110 || event.keyCode === 190) {
        return;
      }
    
      // Rechazar cualquier tecla que no sea un número o el separador decimal
      if (!/^\d$/.test(key) && key !== decimalSeparator) {
        event.preventDefault();
        return;
      }
    
      // Rechazar el separador decimal si ya existe uno en el valor
      if (key === decimalSeparator && value.indexOf(decimalSeparator) !== -1) {
        event.preventDefault();
        return;
      }
    
      // Rechazar la entrada si se supera el número máximo de decimales permitidos
      var decimalIndex = value.indexOf(decimalSeparator);
      if (decimalIndex !== -1 && value.length - decimalIndex > maxDecimals + 1) {
        event.preventDefault();
        return;
      }
    
      // Rechazar la entrada si el valor resultante está fuera del rango de 0 a 10
      var floatValue = parseFloat(value);
      if (isNaN(floatValue) || floatValue < 0 || floatValue > 10) {
        event.preventDefault();
        return;
      }
    }
    
    // Obtener todos los inputs
    var inputs = document.querySelectorAll('input[type="text"]');
    
    // Asignar evento de escucha a cada input
    inputs.forEach(function(input) {
      // Evento de escucha para el evento keydown
      input.addEventListener("keydown", function(event) {
        validateInput(event);
      });
    });
</script>
@endpush